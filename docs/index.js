var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s)
/**
 * @preserve
 * Kontra.js v10.0.0
 */;function i(t,e,i){return t*(1-i)+e*i}function s(t,e,i){return Math.min(Math.max(t,i),e)}let o=()=>{};let h,n,a={};function r(t,e){a[t]=a[t]||[],a[t].push(e)}function l(t,e){a[t]=(a[t]||[]).filter((t=>t!=e))}function c(t,...e){(a[t]||[]).map((t=>t(...e)))}let d={get:(t,e)=>"_proxy"==e||o};function p(){return n}function u(t,{contextless:e=!1}={}){if(h=document.getElementById(t)||t||document.querySelector("canvas"),e&&(h=h||new Proxy({},d)),!h)throw Error("You must provide a canvas element for the game");return n=h.getContext("2d")||new Proxy({},d),n.imageSmoothingEnabled=!1,c("init"),{canvas:h,context:n}}class x{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new x(this.x+t.x,this.y+t.y,this)}subtract(t){return new x(this.x-t.x,this.y-t.y,this)}scale(t){return new x(this.x*t,this.y*t)}normalize(t=this.length()||1){return new x(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?s(this._a,this._d,t):t}set y(t){this._y=this._c?s(this._b,this._e,t):t}}function y(){return new x(...arguments)}class g{constructor(t){return this.init(t)}init(t={}){this.position=y(),this.velocity=y(),this.acceleration=y(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class f extends g{init({width:t=0,height:e=0,context:i=p(),render:s=this.draw,update:o=this.advance,children:h=[],anchor:n={x:0,y:0},opacity:a=1,rotation:l=0,drotation:c=0,ddrotation:d=0,scaleX:u=1,scaleY:x=1,...y}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:n,opacity:a,rotation:l,drotation:c,ddrotation:d,scaleX:u,scaleY:x,...y}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=o,r("init",(()=>{this.context??(this.context=p())}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=2*this.radius);let s=-e*this.anchor.x,o=-i*this.anchor.y;(s||o)&&t.translate(s,o),this.context.globalAlpha=this.opacity,this._rf(),(s||o)&&t.translate(-s,-o),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:o=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=o*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*o,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:n,y:a}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=n,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||o,t._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=s(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}let m=/(\d+)(\w+)/;class w extends f{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(t=>null==(t=p())?void 0:t.font)(),...o}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...o}),this.context&&this._p(),r("init",(()=>{this.font??(this.font=p().font),this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(m),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),this._fw&&e.map((e=>{let i=e.split(" "),s=i.shift(),o=s;i.map((e=>{o+=" "+e,t.measureText(o).width>this._fw&&(this._s.push(s),o=e),s=o})),this._s.push(o)})),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,o)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*o)),i.fillText(s,t,this._fs*this.lineHeight*o)}))}}function b(){return new w(...arguments)}function v(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function P({fps:t=60,clearCanvas:e=!0,update:i=o,render:s,context:h=p(),blur:n=!1}={}){if(!s)throw Error("You must provide a render() function");let a,l,d,u,x,y=0,g=1e3/t,f=1/t,m=e?v:o,w=!0;function b(){if(l=requestAnimationFrame(b),w&&(d=performance.now(),u=d-a,a=d,!(u>1e3))){for(y+=u;y>=g;)c("tick"),x.update(f),y-=g;m(x.context),x.render()}}return n||(window.addEventListener("focus",(()=>{w=!0})),window.addEventListener("blur",(()=>{w=!1}))),r("init",(()=>{x.context??(x.context=p())})),x={update:i,render:s,isStopped:!0,context:h,start(){this.isStopped&&(a=performance.now(),this.isStopped=!1,requestAnimationFrame(b))},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:b,set _last(t){a=t}},x}var _=(t=>(t.burstBalloon="b",t.up="u",t.down="d",t.play="p",t.web3="w",t.selectLevel="l",t.drag="dr",t.kill="k",t.bubbleParticle="bp",t))(_||{});const T=44100,C=new(window.AudioContext||webkitAudioContext),E=new(window.AudioContext||webkitAudioContext),S=(...t)=>M(E,k(...t)),M=(t,...e)=>{let i=t.createBufferSource(),s=t.createBuffer(e.length,e[0].length,T);return e.map(((t,e)=>s.getChannelData(e).set(t))),i.buffer=s,i.connect(t.destination),i.start(),i},k=(t=1,e=.05,i=220,s=0,o=0,h=.1,n=0,a=1,r=0,l=0,c=0,d=0,p=0,u=0,x=0,y=0,g=0,f=1,m=0,w=0)=>{let b,v,P=2*Math.PI,_=r*=500*P/T**2,C=(0<x?1:-1)*P/4,E=i*=(1+2*e*Math.random()-e)*P/T,S=[],M=0,k=0,R=0,F=1,A=0,L=0,I=0;for(l*=500*P/T**3,x*=P/T,c*=P/T,d*=T,p=T*p|0,v=(s=99+T*s)+(m*=T)+(o*=T)+(h*=T)+(g*=T)|0;R<v;S[R++]=I)++L%(100*y|0)||(I=n?1<n?2<n?3<n?Math.sin((M%P)**3):Math.max(Math.min(Math.tan(M),1),-1):1-(2*M/P%2+2)%2:1-4*Math.abs(Math.round(M/P)-M/P):Math.sin(M),I=(p?1-w+w*Math.sin(2*Math.PI*R/p):1)*(0<I?1:-1)*Math.abs(I)**a*t*.3*(R<s?R/s:R<s+m?1-(R-s)/m*(1-f):R<s+m+o?f:R<v-g?(v-R-g)/h*f:0),I=g?I/2+(g>R?0:(R<v-g?1:(v-R)/g)*S[R-g|0]/2):I),b=(i+=r+=l)*Math.sin(k*x-C),M+=b-b*u*(1-1e9*(Math.sin(R)+1)%2),k+=b-b*u*(1-1e9*(Math.sin(R)**2+1)%2),F&&++F>d&&(i+=c,E+=c,F=0),!p||++A%p||(i=E,r=_,F=F||1);return S},R=(t,e,i,s=125)=>{let o,h,n,a,r,l,c,d,p,u,x,y,g,f,m=0,w=[],b=[],v=[],P=0,_=0,C=1,E={},S=T/s*60>>2;for(;C;P++)w=[C=d=y=0],i.map(((s,T)=>{for(c=e[s][P]||[0,0,0],C|=!!e[s][P],f=y+(e[s][0].length-2-!d)*S,g=T==i.length-1,h=2,a=y;h<c.length+g;d=++h){for(r=c[h],p=h==c.length+g-1&&g||u!=(c[0]||0)|r,n=0;n<S&&d;n++>S-99&&p?x+=(x<1)/99:0)l=(1-x)*w[m++]/2||0,b[a]=(b[a]||0)-l*_+l,v[a]=(v[a++]||0)+l*_+l;r&&(x=r%1,_=c[1]||0,(r|=0)&&(w=E[[u=c[m=0]||0,r]]=E[[u,r]]||(o=[...t[u]],o[2]*=2**((r-12)/12),r>0?k(...o):[])))}y=f}));return[b,v]};let F=C,A=null,L=Date.now(),I=Date.now();function D(){let t=0;const e=setInterval((()=>{t++,t>8&&clearInterval(e),L+50>Date.now()||(L=Date.now(),S(...[,1,7,.02,.01,.02,4,.5,,,1,.01,,,150,,.21,,.01]))}),150)}function j(){if(A)return void F.resume();let t=R(...B);A=M(C,...t),A.loop=!0}const B=[[[1,0,220,,1.12,.33,,1.2,,,,,,,.1,,,.55,.01],[.5,0,110,,.52,.9,,.4,,,,,,,.1,,,.32,.07,,-1045]],[[[,-1,,,,,,,10,,,,12,,,,10,,3,,,,,,8,,,,,,,,,,,,,,,,10,,,,12,,,,15,,20,,,,,,15,,,,,,,,,,],[1,1,8,,15,,20,,,,,,,,,,,,8,,15,,20,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,]],[[,-1,,,,,,,10,,,,11,,,,15,,10,,,,,,15,,,,,,,,,,,,,,,,10,,,,13,,,,15,,20,,,,,,27,,,,,,,,,,],[1,1,4,,11,,16,,,,,,,,,,,,4,,11,,16,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,6,,13,,18,,,,,,,,13,,,,]],[[,-1,,,13,,20,,22,,24,,25,,24,,22,,20,,,,15,,,,13,,,,13,,,,13,,,,,,8,,,,,,,,,,,,,,,,13,,,,13,,,,,,12,,15,,20,,,,,,,,,,,,,,,,,,13,,,,15,,,,,,],[1,1,8,,15,,,,,,,,,,17,,12,,6,,13,,18,,,,,,,,,,,,4,,11,,16,,20,,,,,,16,,20,,6,,13,,18,,,,,,,,13,,18,,8,,15,,20,,,,,,22,,,,20,,8,,15,,20,,,,,,,,,,,,]],[[,-1,,,,,,,,,29,,29,,25,,24,,20,,,,,,15,,,,,,,,,,,,,,,,,,27,,25,,24,,25,,24,,,,,,20,,,,,,,,,,,,,,,,,,29,,27,,25,,29,,27,,,,,,32,,,,,,,,,,,,,,,,,,25,,27,,25,,24,,,,,,20,,,,17,,,,,,,,],[1,1,25,,32,,25,,32,,,,,,,,,,24,,31,,24,,32,,,,,,,,,,22,,27,,34,,36,,,,,,,,,,20,,27,,32,,,,,,,,,,,,25,,32,,25,,32,,,,,,,,,,24,,31,,36,,32,,,,,,,,,,21,,32,,35,,,,,,,,,,35,,22,,34,,,,,,,,27,,34,,,,]]],[0,0,1,2,2,3,2],138,{title:"B",instruments:["m","b"],patterns:["Pattern 0","Pattern 1","Pattern 2","Pattern 3"]}];let Y,G=!1,H=0,X=0,U=0,W=0;function O(t){G=!0,H=t.clientX*window.devicePixelRatio,X=t.clientY*window.devicePixelRatio,c(_.down,y(H,X))}function V(t){c(_.up,y(t.clientX*window.devicePixelRatio,t.clientY*window.devicePixelRatio)),G=!1,j(),c(_.up,y(H,X))}function $(t){G&&(U=t.clientX*window.devicePixelRatio,W=t.clientY*window.devicePixelRatio,Q())}function q(t){G=!0;const e=t.touches[0];return H=e.clientX*window.devicePixelRatio,X=e.clientY*window.devicePixelRatio,c(_.down,y(H,X)),t.preventDefault(),j(),!1}function z(t){const e=t.changedTouches[0];c(_.up,y(e.clientX*window.devicePixelRatio,e.clientY*window.devicePixelRatio)),G=!1}function N(t){if(G){const e=t.touches[0];U=e.clientX*window.devicePixelRatio,W=e.clientY*window.devicePixelRatio,Q()}}function Q(){const t=U-H,e=W-X;c(_.drag,{detail:{diffX:t,diffY:e}})}class J{constructor(t){e(this,"pos",y(0,0)),e(this,"canvas"),e(this,"lerpFactor",.04),e(this,"skipFrame",!1),this.canvas=t,this.pos=y(t.width,t.height)}setPosition(t){this.skipFrame=!0,this.pos=y(t)}follow(t,e={lerp:!0}){const s=t.x-this.canvas.width/2,o=t.y-this.canvas.height/2;this.skipFrame||(e.lerp?this.pos=y(i(this.pos.x,s,this.lerpFactor),i(this.pos.y,o,this.lerpFactor)):this.pos=y(s,o))}apply(t){t.setTransform(1,0,0,1,0,0),t.translate(-this.pos.x,-this.pos.y),this.skipFrame=!1}clear(t){t.clearRect(-1e3+this.pos.x,-1e3+this.pos.y,this.canvas.width+2e3,this.canvas.height+2e3)}}const K=y(0,0);class Z{constructor(t){e(this,"mass",1),e(this,"velocity",y(0,0)),e(this,"force",y(K)),e(this,"pos",y(0,0)),e(this,"radius",.5),e(this,"baseSpeed",y(0,0)),this.pos=y(t)}applyForce(t){this.force=this.force.add(t)}setSpeed(t){this.baseSpeed=y(t),this.velocity=y(t)}update(){const t=y(this.force.x/this.mass,this.force.y/this.mass);this.velocity=this.velocity.add(t).add(this.baseSpeed),this.velocity.clamp(-8,-8,8,8),this.pos=this.pos.add(this.velocity),this.force=y(K)}render(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,5,0,2*Math.PI),t.fillStyle="#abc",t.fill()}}class tt{constructor(t,i,s,o=.05){e(this,"p1"),e(this,"p2"),e(this,"length",1),e(this,"stiffness",.05),e(this,"damping",.5),e(this,"normalVector",y(0,0)),this.p1=t,this.p2=i,this.length=s,this.stiffness=o}hookesLaw(){const t=this.p2.pos.x-this.p1.pos.x,e=this.p2.pos.y-this.p1.pos.y,i=Math.sqrt(t*t+e*e);this.normalVector=y(e,-t).normalize();const s=(i-this.length)*this.stiffness,o=s*(t/i),h=s*(e/i);this.p1.applyForce(y(o,h)),this.p2.applyForce(y(-o,-h));const n=this.p2.velocity.x-this.p1.velocity.x,a=this.p2.velocity.y-this.p1.velocity.y,r=n*this.damping,l=a*this.damping;this.p1.applyForce(y(r,l)),this.p2.applyForce(y(-r,-l))}update(){this.hookesLaw(),this.p1.update(),this.p2.update()}render(t,e,i={hideParticles:!1}){i.hideParticles||(e instanceof ct&&(t.beginPath(),t.moveTo(this.p1.pos.x,this.p1.pos.y),t.lineTo(this.p2.pos.x,this.p2.pos.y),t.strokeStyle="#abc",t.lineWidth=3,t.stroke()),this.p1.render(t),this.p2.render(t))}renderNormalVector(t){const e=(this.p1.pos.x+this.p2.pos.x)/2,i=(this.p1.pos.y+this.p2.pos.y)/2,s=e+20*this.normalVector.x,o=i+20*this.normalVector.y;t.beginPath(),t.moveTo(e,i),t.lineTo(s,o),t.stroke()}}function et(t,e,i){const s=t.x;let o=t.y,h=e.x,n=e.y,a=i.x,r=i.y;if(n>r&&([h,a]=[a,h],[n,r]=[r,n]),o!==n&&o!==r||(o+=1e-4),o<n||o>r)return!1;if(s>Math.max(h,a))return!1;if(s<Math.min(h,a))return!0;return(o-n)/(s-h)>=(r-n)/(a-h)}function it(t,e,i){const s=i.subtract(e),o=t.subtract(e),h=s.dot(s),n=Math.max(0,Math.min(1,o.dot(s)/h));return e.add(s.scale(n))}function st(t,e,i,s,o){const h=o*o,n=h*o;return{x:.5*(2*e.x+(-t.x+i.x)*o+(2*t.x-5*e.x+4*i.x-s.x)*h+(-t.x+3*e.x-3*i.x+s.x)*n),y:.5*(2*e.y+(-t.y+i.y)*o+(2*t.y-5*e.y+4*i.y-s.y)*h+(-t.y+3*e.y-3*i.y+s.y)*n)}}function ot(t,e,i){return t.distance(e)*t.distance(e)<=i*i}function ht(t){return t*t*(3-2*t)}function nt(t){return t.reduce(((t,e)=>t.add(e.pos)),y(0,0)).scale(1/t.length)}let at={r:50,g:150,b:155},rt={r:255,g:20,b:20};function lt(t){const e=13e4;t=Math.max(0,Math.min(t,e));const i=at,s=rt,o=(t-2e4)/11e4;return`rgb(${Math.round(i.r+o*(s.r-i.r))}, ${Math.round(i.g+o*(s.g-i.g))}, ${Math.round(i.b+o*(s.b-i.b))})`}class ct{constructor(t,i={}){e(this,"pos"),e(this,"startPos"),e(this,"speed"),e(this,"path"),e(this,"particles",[]),e(this,"springs",[]),e(this,"maxHaltTime",3e3),e(this,"ellapsedHaltTime",this.maxHaltTime+1),e(this,"centerPoint",y(0,0)),e(this,"initialCenterPoint",y(0,0)),e(this,"direction",1),e(this,"stiffness",1),e(this,"gravity",y(0,0)),this.stiffness=i.stiffness||1,this.startPos=t[0],this.pos=t[0],this.gravity=(null==i?void 0:i.gravity)?y(i.gravity):y(0,0),this.path=i.path?y(i.path):y(0,0),this.speed=i.speed?y(i.speed):y(0,0),this.direction=i.direction||0,t.forEach((t=>{const e=new Z(y(t));e.setSpeed(this.speed.scale(this.direction)),this.particles.push(e)})),this.initialCenterPoint=nt(this.particles),t.forEach(((e,i)=>{const s=(i+1)%t.length,o=e.distance(t[s]);this.springs.push(new tt(this.particles[i],this.particles[s],o,this.stiffness))}))}handlePathMovement(){if(!this.path.x&&!this.path.y)return;if(this.ellapsedHaltTime+=1e3/60,this.ellapsedHaltTime<=this.maxHaltTime)return void this.particles.forEach((t=>{t.setSpeed(y(0,0))}));const t=this.particles[0].pos.subtract(this.startPos);t.x>=this.path.x&&t.y>=this.path.y&&1===this.direction?(this.ellapsedHaltTime=0,this.direction=-1):t.x<=-this.path.x&&t.y<=-this.path.y&&-1===this.direction&&(this.ellapsedHaltTime=0,this.direction=1),this.particles.forEach((t=>{t.setSpeed(this.speed.scale(this.direction))}))}update(){this.handlePathMovement(),this.particles.forEach((t=>{t.applyForce(this.gravity),t.update()})),(this.gravity.x||this.gravity.y)&&this.springs.forEach((t=>t.update())),this.centerPoint=nt(this.particles)}render(t){this.renderPath(t),this.particles.forEach((e=>{e.render(t)})),this.springs.forEach((e=>{e.render(t,this)})),this.renderRigidBody(t)}renderRigidBody(t){if(this.particles.length){t.save(),t.beginPath(),t.moveTo(this.particles[0].pos.x,this.particles[0].pos.y);for(let e=1;e<this.particles.length;e++)t.lineTo(this.particles[e].pos.x,this.particles[e].pos.y);t.closePath(),t.fillStyle="rgba(255, 255, 255, 0.1)",t.fill(),t.restore()}}renderPath(t){this.path&&(t.save(),t.beginPath(),t.strokeStyle=lt(5e4),t.moveTo(this.initialCenterPoint.x-this.path.x,this.initialCenterPoint.y-this.path.y),t.lineTo(this.initialCenterPoint.x+this.path.x,this.initialCenterPoint.y-this.path.y),t.stroke(),t.restore())}}class dt{constructor(t,i,s){e(this,"state",""),e(this,"springs",[]),e(this,"particles",[]),e(this,"volume",0),e(this,"gasPressure",0),e(this,"centerPoint",y(0,0)),e(this,"balloonGravity",y(0,0)),e(this,"isStationairy",!1),e(this,"balloonType","p"),e(this,"text"),e(this,"lineWidth",10),e(this,"hideParticles",!1),e(this,"externalForce",y(0,0)),e(this,"isBalloon",!0),e(this,"hideText",!1),e(this,"ellapsedDeadTime",0),e(this,"timeToLive",0),e(this,"gasAmount",7e4),e(this,"R",.3),e(this,"T",3),this.hideText=(null==s?void 0:s.hideText)||!1,this.text=b({text:"",font:"32px Arial",color:"white",x:300,y:100,anchor:{x:.7,y:.2},context:t.getContext("2d")}),this.gasAmount=(null==s?void 0:s.gasAmount)||65e3,this.timeToLive=(null==s?void 0:s.timeToLive)||0,this.lineWidth=(null==s?void 0:s.lineWidth)||10,this.hideParticles=(null==s?void 0:s.hideParticles)||!1,this.balloonType=(null==s?void 0:s.balloonType)||"p";const o=(null==s?void 0:s.numParticles)||20,h=(null==s?void 0:s.distance)?5*(null==s?void 0:s.distance):50,n=(null==s?void 0:s.length)||10,a=(null==s?void 0:s.stiffness)||.08;this.isStationairy=(null==s?void 0:s.isStationairy)||!1;const r=2*Math.PI/o;for(let e=0;e<o;e++){const t=e*r,s=i.x+h*Math.cos(t),o=i.y+h*Math.sin(t);this.particles.push(new Z(y(s,o)))}for(let e=0;e<o;e++){const t=(e+1)%o,i=new tt(this.particles[e],this.particles[t],n,a);this.springs.push(i)}}calculateVolume(){let t=0;const e=this.particles.length;for(let i=0;i<e;i++){const s=this.particles[i].pos,o=this.particles[(i+1)%e].pos;t+=s.x*o.y-o.x*s.y}return Math.abs(t)/2}calculateGasPressure(){return this.volume=this.calculateVolume(),this.gasAmount*this.R*this.T/this.volume}updateBalloonGravity(){this.timeToLive-=1e3/60;const t=13e4,e=.2*(Math.max(500,Math.min(this.gasAmount,t))/t)-.1;this.balloonGravity=y(.001,-e)}applyGasPressureForce(){const t=this.calculateGasPressure();this.springs.forEach((e=>{const i=e.p1,s=e.p2;e.length=this.gasAmount/5e3,e.length<1&&(e.length=1),"d"===this.balloonType?(i.applyForce(e.normalVector.scale(t).scale(.1)),s.applyForce(e.normalVector.scale(t).scale(-.1))):(i.applyForce(e.normalVector.scale(t)),s.applyForce(e.normalVector.scale(t).scale(-1)))}))}update(){"d"===this.state?(this.ellapsedDeadTime+=1e3/60,this.ellapsedDeadTime<=2e3&&this.particles.forEach((t=>{t.applyForce(this.balloonGravity.add(this.externalForce)),t.update()}))):(this.springs.forEach((t=>t.update())),this.particles.forEach((t=>{t.applyForce(this.balloonGravity.add(this.externalForce))}))),this.centerPoint=nt(this.particles),this.handleGasInput(),this.updateBalloonGravity(),this.applyGasPressureForce();for(let t=0;t<this.particles.length;t++)for(let e=t+1;e<this.particles.length;e++){const i=this.particles[t],s=this.particles[e],o=i.pos.distance(s.pos),h=7.5;if(o<h){const t=h-o,e=i.pos.subtract(s.pos).normalize();i.pos=i.pos.add(e.scale(t/2)),s.pos=s.pos.subtract(e.scale(t/2))}}}handleGasInput(){if(this.isStationairy)return;if("d"===this.state)return;G?(I+150>Date.now()||(I=Date.now(),S(...[.2,,513,,,.01,,.5,,,-275,.08,,,,,.15,.87,.07,,141])),this.gasAmount+=500):this.gasAmount-=500,this.gasAmount<1e4&&(this.gasAmount=1e4),this.gasAmount>130999&&this.setState("d")}setState(t){if(this.state=t,"d"===t)S(...[1.9,,346,.01,.04,.11,4,4.4,85,,,,,,367,,.32,.64,.16,,-1094]),c(_.burstBalloon,this),this.springs.length=0}render(t){"d"!==this.state&&(this.springs.forEach((e=>e.render(t,this,{hideParticles:this.hideParticles}))),this.renderOutline(t),this.renderGasAmount(y(this.centerPoint.x+10,this.centerPoint.y-10)),this.renderEnemyText(y(this.centerPoint.x+10,this.centerPoint.y-10)))}renderEnemyText(t){"e"===this.balloonType&&(this.text.text="XIII",this.text.color=lt(13e4),this.text.x=t.x,this.text.y=t.y,this.text.render())}renderGasAmount(t){if(this.hideText)return;const e=(this.gasAmount/13e4*13).toFixed(1);this.text.text=e,this.text.color=lt(this.gasAmount),this.text.x=t.x,this.text.y=t.y,this.text.render()}renderOutline(t){t.beginPath(),t.moveTo(this.particles[0].pos.x,this.particles[0].pos.y),"d"===this.balloonType?t.strokeStyle="#fefefe66":"e"===this.balloonType?t.strokeStyle=lt(13e4):"f"===this.balloonType?t.strokeStyle="#1c2":t.strokeStyle=lt(this.gasAmount),t.lineWidth=this.lineWidth;const e=this.particles.map((t=>t.pos));for(let i=0;i<e.length;i++){const s=e[(i-1+e.length)%e.length],o=e[i],h=e[(i+1)%e.length],n=e[(i+2)%e.length];0===i&&t.moveTo(o.x,o.y);for(let e=0;e<1;e+=.1){const i=st(s,o,h,n,e);t.lineTo(i.x,i.y)}}t.closePath(),t.stroke()}}const pt=1800;const ut=500;const xt=1800,yt=2e3;const gt=1800;const ft=1800;let mt=200;const wt=1800;let bt=200;const vt=1800;function Pt(){return{playerPos:y(200,-200),goalPos:y(2550,2550),objects:[{box:{pos:y(-500,0),width:1500,height:100}},{box:{pos:y(-500,-900),width:100,height:1e3}},{box:{pos:y(1e3,-900),width:100,height:1e3}},{box:{pos:y(-500,-900),width:1500,height:100}},{text:{pos:y(250,50),text:"感谢游玩！"}},{box:{pos:y(350,-450),width:100,height:100}}]}}class _t{constructor(t){e(this,"alpha",0),e(this,"fadeDirection",1),e(this,"fadeSpeed",.01),e(this,"radius",70),this.pos=t}update(){this.alpha+=this.fadeDirection*this.fadeSpeed,this.alpha>=.8?(this.alpha=.8,this.fadeDirection=-1):this.alpha<=.1&&(this.alpha=.1,this.fadeDirection=1)}render(t){t.save(),t.globalAlpha=this.alpha,t.fillStyle="white",t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.fill(),t.restore()}checkIfGoalReached(t){if(ot(t.centerPoint,this.pos,this.radius))return!0}}const Tt="b-";function Ct(t,e){try{localStorage.setItem(Tt+t,e)}catch(i){}}function Et(t){let e=null;try{const i=localStorage.getItem(Tt+t);i&&(e=JSON.parse(i))}catch(i){try{e=localStorage.getItem(Tt+t)}catch(s){}}return e}class St{constructor(t,i,s,o,h,n=40,a,d){e(this,"circlePos",y(0,0)),e(this,"circleRadius",0),e(this,"text"),e(this,"smallCircles",[]),e(this,"baseY"),e(this,"baseRadius",0),e(this,"time",0),e(this,"timeRadius",0),e(this,"duration",2e3),e(this,"direction",1),e(this,"directionRadius",1),e(this,"lineDashLength",100),e(this,"lineDashGap",50),e(this,"isDestroyed",!1),e(this,"isClicked",!1),e(this,"onUp",(t=>{var e;if(this.isClicked||this.isDestroyed)return;const i=null==(e=this.canvas.getContext("2d"))?void 0:e.getTransform();i&&ot(y(t.x,t.y),this.circlePos.add(y(i.e,i.f)),this.circleRadius)&&(S(...[.4,,23,,.21,.02,4,3.1,,26,,,,,75,,.43,.81,.01,.46,-690]),D(),this.isClicked=!0,l(_.up,this.onUp),c(this.gameEvent,this.gameEventArgs),this.spawnSmallCircles())})),this.canvas=t,this.gameEvent=a,this.gameEventArgs=d,this.circlePos=y(i,s),this.baseRadius=o,this.baseY=s,r(_.up,this.onUp),this.text=b({text:h,font:`${n}px Arial`,color:lt(0),x:i,y:s,context:this.canvas.getContext("2d"),anchor:{x:.5,y:.5}})}update(){if(this.isDestroyed)return;this.time+=10*this.direction,this.timeRadius+=5*this.directionRadius;const t=this.time%this.duration/this.duration,e=this.timeRadius%this.duration/this.duration;(t>=.98||t<=0)&&(this.direction*=-1),(e>=.98||e<=0)&&(this.directionRadius*=-1);const i=ht(t),s=ht(e);this.circlePos.y=this.baseY+(10*i-3),this.circleRadius=this.baseRadius+(10*s-3),this.text.y=this.circlePos.y,this.smallCircles.forEach((t=>{t.update(),t.externalForce.x=2*(Math.random()-.5),t.externalForce.y-=.02})),this.isClicked&&(this.lineDashLength-=2,this.lineDashLength<=1&&(this.lineDashLength=1),this.lineDashGap+=5,this.baseRadius=1.01*this.baseRadius+4),this.smallCircles=this.smallCircles.filter((t=>t.centerPoint.y>-2e3))}render(t){this.isDestroyed||(this.baseRadius<=500&&(t.save(),t.beginPath(),t.arc(this.circlePos.x,this.circlePos.y,this.circleRadius,0,2*Math.PI),this.isClicked&&t.setLineDash([this.lineDashLength,this.lineDashGap]),t.strokeStyle=lt(0),t.lineWidth=5,t.stroke(),t.setLineDash([]),t.restore()),this.isClicked||this.text.render(),this.smallCircles.forEach((e=>e.render(t))))}spawnSmallCircles(){for(let t=0;t<10;t++){const t=Math.random()*Math.PI*2,e=Math.random()*Math.PI,i=y(this.circlePos.x+Math.cos(e)*this.circleRadius,this.circlePos.y+Math.sin(t)*this.circleRadius),s=new dt(this.canvas,i,{gasAmount:5e3,length:1,distance:1,numParticles:10,stiffness:.2,lineWidth:2,hideParticles:!0,hideText:!0,isStationairy:!0});this.smallCircles.push(s)}}destroy(){this.isDestroyed=!0,l(_.up,this.onUp)}}class Mt{constructor(t){e(this,"rigidBody"),e(this,"startPos"),e(this,"isSpike",!0),this.startPos=t;const i=[y(0,0).add(t),y(25,50).add(t),y(-25,50).add(t)];this.rigidBody=new ct(i,{stiffness:.1,gravity:y(0,.01)})}update(){this.rigidBody.update()}render(t){if(this.particles.length){t.save(),t.beginPath(),t.moveTo(this.particles[0].pos.x,this.particles[0].pos.y);for(let e=1;e<this.particles.length;e++)t.lineTo(this.particles[e].pos.x,this.particles[e].pos.y);t.closePath(),t.fillStyle=lt(13e4),t.fill(),t.restore(),this.rigidBody.render(t)}}get springs(){return this.rigidBody.springs}get particles(){return this.rigidBody.particles}}const kt=[function(){return{playerPos:y(0,0),goalPos:y(1550,80),objects:[{box:{pos:y(-500,160),width:2800,height:200}},{text:{pos:y(300,200),text:"⇨ 贴着地面前进 ⇨"}},{text:{pos:y(1550,200),text:"得分"}}]}},function(){return{playerPos:y(500,0),goalPos:y(1200,-400),objects:[{box:{pos:y(-500,160),width:2e3,height:200}},{box:{pos:y(1500,-1e3),width:300,height:2800}},{text:{pos:y(600,200),text:"⇨ 贴着地面前进 ⇨"}},{text:{pos:y(1550,0),text:"Keep holding"}},{text:{pos:y(1200,200),text:"按住以前进 ⇧"}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1800,1720),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{text:{pos:y(710,1750),text:"按住以前进 ⇧"}},{text:{pos:y(980,1825),text:"得分 ⇨"}},{box:{pos:y(700,1650),width:200,height:150}},{box:{pos:y(-100,pt),width:2700,height:100}}]}},function(){return{playerPos:y(500,0),goalPos:y(0,-200),objects:[{box:{pos:y(-1e3,160),width:2e3,height:200}},{box:{pos:y(1e3,-1e3),width:300,height:2800}},{box:{pos:y(-1e3,-400),width:2e3,height:100}},{text:{pos:y(750,200),text:"按住以前进 ⇧"}},{text:{pos:y(1050,0),text:"保持按住"}},{text:{pos:y(600,-350),text:"⇦ 贴着天花板前进 ⇦"}}]}},function(){return{playerPos:y(150,280),goalPos:y(4650,820),objects:[{text:{pos:y(400,525),text:"⇨"}},{box:{pos:y(-100,ut),width:1500,height:100}},{text:{pos:y(1200,525),text:"Falling is OK"}},{box:{pos:y(1750,700),width:1500,height:100}},{text:{pos:y(2700,725),text:"Don't be afraid"}},{box:{pos:y(3540,900),width:1800,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1400,950),objects:[{box:{pos:y(900,1450),width:350,height:350}},{box:{pos:y(900,850),width:350,height:350}},{box:{pos:y(0,650),width:yt,height:200}},{box:{pos:y(700,1650),width:200,height:150}},{text:{pos:y(2020,200),text:"Up ⇧"}},{text:{pos:y(2020,1600),text:"Up ⇧"}},{text:{pos:y(2020,1e3),text:"Up ⇧"}},{text:{pos:y(1500,800),text:"⇦ 贴着天花板向左 ⇦"}},{box:{pos:y(yt,-100),width:150,height:2e3}},{box:{pos:y(-100,-100),width:2250,height:100}},{box:{pos:y(-100,xt),width:2100,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1650,1e3),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{box:{pos:y(1900,850),width:350,height:350}},{box:{pos:y(-100,650),width:2e3,height:200}},{box:{pos:y(700,1650),width:200,height:150}},{box:{pos:y(1700,1650),width:200,height:150}},{box:{pos:y(-100,gt),width:2600,height:100}}]}},function(){return{playerPos:y(0,0),goalPos:y(1550,80),objects:[{box:{pos:y(-500,160),width:2800,height:200}},{text:{pos:y(100,200),text:"Some bubbles are friendly"}},{enemy:{pos:y(500,-20),options:{balloonType:"f"}}},{enemy:{pos:y(860,-50),options:{balloonType:"f"}}}]}},function(){return{playerPos:y(200,0),goalPos:y(1200,-400),objects:[{box:{pos:y(-500,160),width:2e3,height:200}},{box:{pos:y(1500,-1e3),width:200,height:2800}},{enemy:{pos:y(1200,-20),options:{balloonType:"e"}}},{enemy:{pos:y(860,-50),options:{balloonType:"f"}}},{text:{pos:y(200,200),text:"Some bubbles are dangerous"}},{text:{pos:y(200,250),text:"Use friends to take foes"}}]}},function(){return{playerPos:{x:0,y:0},goalPos:{x:2550,y:80},objects:[{box:{pos:{x:-500,y:160},width:1e3,height:100}},{box:{pos:{x:1e3,y:160},width:500,height:100,options:{path:{x:500,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:2e3,y:160},width:2e3,height:100}}]}},function(){return{playerPos:{x:0,y:0},goalPos:{x:2550,y:80},objects:[{box:{pos:{x:-500,y:160},width:1e3,height:100}},{box:{pos:{x:1e3,y:160},width:250,height:100,options:{path:{x:250,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:1550,y:160},width:250,height:100,options:{path:{x:250,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:2100,y:160},width:2e3,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(2400,1720),objects:[{box:{pos:y(700,1600),width:mt,height:mt}},{box:{pos:y(900,1400),width:mt,height:400}},{box:{pos:y(1100,1200),width:mt,height:600}},{box:{pos:y(1300,1e3),width:mt,height:800}},{box:{pos:y(-100,ft),width:3400,height:100}}]}},function(){return{playerPos:y(0,0),goalPos:y(0,500),objects:[]}},function(){return{playerPos:y(150,1450),goalPos:y(2200,1720),objects:[{enemy:{pos:y(400,1600),options:{balloonType:"f"}}},{enemy:{pos:y(2e3,1750),options:{balloonType:"e"}}},{enemy:{pos:y(1e3,1e3),options:{balloonType:"e"}}},{box:{pos:y(700,1600),width:bt,height:bt}},{box:{pos:y(900,1400),width:bt,height:400}},{box:{pos:y(1100,1200),width:bt,height:600}},{box:{pos:y(1300,1e3),width:bt,height:800}},{box:{pos:y(-100,wt),width:3400,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1800,1720),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{text:{pos:y(710,1750),text:"Hold to go ⇧"}},{box:{pos:y(700,1650),width:200,height:150}},{enemy:{pos:y(1e3,1500),options:{balloonType:"f"}}},{spike:{pos:y(1025,1650)}},{spike:{pos:y(1100,1650)}},{box:{pos:y(-100,vt),width:2700,height:100}}]}},function(){return{playerPos:{x:100,y:1360},goalPos:{x:900,y:760},objects:[{box:{pos:{x:-600,y:1500},width:2e3,height:150}},{box:{pos:{x:1200,y:0},width:200,height:1500}},{box:{pos:{x:400,y:1060},width:800,height:50}}]}},function(){return{playerPos:{x:100,y:1360},goalPos:{x:750,y:520},objects:[{box:{pos:{x:-600,y:1500},width:2e3,height:150}},{box:{pos:{x:1200,y:0},width:200,height:1500}},{box:{pos:{x:400,y:1060},width:550,height:50}},{box:{pos:{x:400,y:660},width:550,height:50}}]}},function(){return{playerPos:{x:300,y:1200},goalPos:{x:1900,y:1e3},objects:[{box:{pos:{x:0,y:1400},width:1e3,height:150}},{box:{pos:{x:1300,y:1700},width:100,height:1500}},{spike:{pos:{x:1300,y:1600}}},{box:{pos:{x:1540,y:1700},width:100,height:1500}},{spike:{pos:{x:1540,y:1600}}},{box:{pos:{x:1650,y:1150},width:450,height:50}},{box:{pos:{x:1250,y:800},width:450,height:50}},{box:{pos:{x:1750,y:1500},width:900,height:150}},{enemy:{pos:{x:1150,y:1450},options:{balloonType:"f"}}},{enemy:{pos:{x:1400,y:1350},options:{balloonType:"f"}}},{enemy:{pos:{x:900,y:900},options:{balloonType:"e"}}}]}},function(){return{playerPos:{x:260,y:1300},goalPos:{x:2570,y:1080},objects:[{box:{pos:{x:0,y:1400},width:4300,height:175}},{box:{pos:{x:850,y:800},width:100,height:100}},{box:{pos:{x:1500,y:500},width:100,height:100}},{box:{pos:{x:1250,y:800},width:650,height:100}},{box:{pos:{x:2400,y:1250},width:100,height:150}},{box:{pos:{x:3060,y:1080},width:150,height:320}},{enemy:{pos:{x:1400,y:1350},options:{balloonType:"f"}}},{enemy:{pos:{x:2100,y:1100},options:{balloonType:"f"}}},{enemy:{pos:{x:2100,y:1100},options:{balloonType:"e"}}},{enemy:{pos:{x:-100,y:1200},options:{balloonType:"e"}}},{spike:{pos:{x:2250,y:1300}}},{spike:{pos:{x:2900,y:1300}}}]}},function(){return{playerPos:y(0,0),goalPos:y(2550,80),objects:[{box:{pos:y(-500,160),width:1500,height:100}},{spike:{pos:y(900,-500)}},{spike:{pos:y(800,-500)}},{spike:{pos:y(1900,-50)}},{spike:{pos:y(2150,-50)}},{box:{pos:y(1e3,-200),width:500,height:100,options:{path:{x:500,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:y(1700,160),width:1500,height:100}}]}},Pt,Pt];function Rt(t,e,i=1,s){const o=[];let h=kt[i-1]();s&&(h=s);const n=new dt(t,y(h.playerPos)),a=new _t(y(h.goalPos));return e.setPosition(n.centerPoint),h.objects.forEach((e=>{var i;if(e.box)o.push(function(t,e,i,s){const o=[y(t),y(t.x+e,t.y),y(t.x+e,t.y+i),y(t.x,t.y+i)];return new ct(o,s)}(e.box.pos,e.box.width,e.box.height,null==(i=e.box)?void 0:i.options));else if(e.text){const i=b({x:e.text.pos.x,y:e.text.pos.y,text:e.text.text,font:"32px Arial",context:t.getContext("2d")});o.push(i)}else e.enemy?o.push(new dt(t,y(e.enemy.pos),{stiffness:.08,isStationairy:!0,hideText:!0,hideParticles:!0,...e.enemy.options})):e.spike&&o.push(new Mt(y(e.spike.pos)))})),{player:n,goal:a,gameObjects:o}}function Ft(t,e){const i=[];let s=(kt.length-2)/2;(null==e?void 0:e.bonusLevels.length)&&(s=e.bonusLevels.length/2);for(let h=1;h<=s;h++)for(let s=1;s<=2;s++){const o=225*h-400,n=225*s-400;let a=2*h;1===s&&(a-=1),a>=13&&(a+=1);let r=`关卡 ${a}`,l=Et(`complete-${a}`);const c={levelId:a,levelData:null};(null==e?void 0:e.bonusLevels.length)&&(r=`奖励 ${a}`,l=Et(`complete-bonus-${e.bonusLevels[a-1].levelId}`),c.levelData=e.bonusLevels[a-1]),l&&(a<10&&(r+="\n    ✔"),a>=10&&(r+="\n     ✔"));const d=new St(t,o,n,75,r,30,_.play,c);i.push(d)}const o=b({text:"拖拽屏幕查看更多关卡",font:"32px Arial",color:lt(1e3),x:0,y:300,anchor:{x:.5,y:.5},context:t.getContext("2d")});return i.push(o),i}let At,Lt;function It(){Lt.forEach((t=>{const e=window.devicePixelRatio||1;t.width=window.innerWidth*e,t.height=window.innerHeight*e,t.style.position="absolute",t.style.left="0",t.style.top="0";const i=t.getContext("2d");i&&i.scale(e,e)}))}let Dt=0,jt=0;function Bt(t,e){return t!==e&&(null==t?void 0:t.isBalloon)&&(null==e?void 0:e.isSpike)&&"d"!==(null==t?void 0:t.state)}let Yt=!1;async function Gt(){if(Yt)return;r(_.selectLevel,(()=>{var t,e,i,s;Yt=!0,null==(t=document.getElementById("w"))||t.remove(),null==(e=document.getElementById("c"))||e.remove(),null==(i=document.getElementById("s"))||i.remove(),null==(s=document.getElementById("q"))||s.remove()}));const t=function(){const t=document.createElement("div");return t.id="w",t.style.position="absolute",t.style.bottom="13vh",t.style.zIndex="99",t.style.height="0",t.style.width="100vw",t.style.display="flex",t.style.alignItems="flex-end",t.style.justifyContent="space-evenly",document.body.appendChild(t),t}(),[e,i]=function(t){const e=document.createElement("div"),i=document.createElement("div");i.style.bottom="16vh",e.id="s",i.id="q",[e,i].forEach((t=>{t.style.color="#fff",t.style.display="flex",t.style.position="absolute",t.style.flexDirection="column",t.style.alignItems="center"}));const s=document.createElement("div"),o=document.createElement("div"),h=document.createElement("div"),n=document.createElement("div");h.textContent="正在加载NPC",n.textContent="正在加载奖励关卡",e.appendChild(h),e.appendChild(s),i.appendChild(n),i.appendChild(o),[s,o].forEach((t=>{t.style.border="16px solid #fff",t.style.borderTop="16px solid #1aa",t.style.borderRadius="50%",t.style.width="75px",t.style.height="75px",t.style.animation="spin 2s linear infinite"}));const a=document.styleSheets[0];return a.insertRule("\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ",a.cssRules.length),t.appendChild(e),t.appendChild(i),[e,i]}(t),[s,o,h,n]=await function(){const t=import(new URL("https://esm.sh/thirdweb@5.50.0")),e=import(new URL("https://esm.sh/thirdweb@5.50.0/chains")),i=import(new URL("https://esm.sh/thirdweb@5.50.0/extensions/erc721")),s=import(new URL("https://esm.sh/thirdweb@5.50.0/storage"));return Promise.all([t,e,i,s])}();if(Yt)return t.removeChild(e),void t.removeChild(i);const a=s.createThirdwebClient({clientId:"1208e5a68330be8540c30917e7065d4d"});(async function(t,e){const i=e.download({client:t,uri:"ipfs://QmaGn65fZnKw25fqYGNqpzpjsXmnLGUdRPs5cvFEkquNnQ"}),s=e.download({client:t,uri:"ipfs://QmPHsFPjchGU2J66gS9G5uQuPaCPmc8Rx6yzFWTYtyozFB"}),o=e.download({client:t,uri:"ipfs://QmckDTy8fDwUtWxbEHjdMjSmUS7VJV5u9zDF4jQVBfXS9P"}),h=e.download({client:t,uri:"ipfs://QmSmJq4vTHeQvdkWX1qcCQMUJJpxWc5jTTZQRPPimmBAKn"});return Promise.all([i,s,o,h])})(a,n).then((t=>async function(t){const e=t.map((t=>fetch(t.url)));await Promise.all(e).then((t=>Promise.all(t.map((t=>t.json()))))).then((t=>{se=t,se.sort(((t,e)=>t.levelId-e.levelId)),function(t,e){ne.length=0,Ft(t,{bonusLevels:e}).forEach((t=>ne.push(t)))}(Ht,se),function(){const t=new St(Ht,0,120,75,"奖励",40,_.selectLevel,{type:"b"});oe.push(t)}()}))}(t))).then((()=>{t.removeChild(i)}));(async function(t,e,i){const s=document.createElement("div");s.id="c",s.style.position="absolute",s.style.bottom="10vh",s.style.zIndex="9",s.style.width="100vw",s.style.display="flex",s.style.alignItems="flex-end",s.style.justifyContent="center",s.style.color="#fff",s.innerHTML="";const o=await e.getNFTs({contract:t,start:0,count:3});if(Yt)return;document.body.appendChild(s);const h=[];o.forEach((t=>{var e,o,n,a;const r=document.createElement("img");r.src=null==(e=null==t?void 0:t.metadata)?void 0:e.image,r.width=1e3,r.height=1e3,r.style.width="10vw",r.style.height="auto",r.style.borderRadius="50%",r.style.animation="spin 5s linear infinite";const l=JSON.stringify({r:null==(o=t.metadata)?void 0:o.attributes[0].value,g:null==(n=t.metadata)?void 0:n.attributes[1].value,b:null==(a=t.metadata)?void 0:a.attributes[2].value});r.setAttribute("r",l),r.addEventListener("click",(()=>{var e,i,o;for(let t=0;t<h.length;t++){h[t].style.border="none"}r.style.border="2px solid #fff",s.innerHTML=`I, ${null==(e=t.metadata)?void 0:e.name}, give you ${null==(i=t.metadata)?void 0:i.description}`,o=JSON.parse(r.getAttribute("r")),at=o})),i.appendChild(r),h.push(r)}))})(s.getContract({client:a,address:"0xcA61C32f3912b3882fB488eBF44F8275f41faFf1",chain:o.avalanche}),h,t).then((()=>{t.removeChild(e)}))}const{canvas:Ht}=u("g"),{canvas:Xt}=u("t"),{canvas:Ut}=u("b");let Wt="m",Ot="l";const Vt=new class{constructor(t){e(this,"targetY",-10),e(this,"lerpFactor",.09),e(this,"pos",y(0,0)),e(this,"state","fadein"),this.canvas=t,this.pos.y=t.height}getState(){return this.state}update(){this.pos.y-2>=this.targetY?this.pos.y=i(this.pos.y,this.targetY,this.lerpFactor):this.pos.y=i(this.pos.y,this.targetY-this.canvas.height,this.lerpFactor),this.handleState()}handleState(){"fadein"===this.state&&this.isFadeInComplete()?this.state="fadeout":"fadeout"===this.state&&this.isFadeOutComplete()&&(this.state="comeplete")}render(t){const{width:e,height:i}=this.canvas;t.save(),t.clearRect(0,0,e,i),t.fillStyle="black",t.fillRect(0,this.pos.y,e,i),t.restore()}isFadeInComplete(){return this.pos.y<=this.targetY}isFadeOutComplete(){return this.pos.y-2<=this.targetY-this.canvas.height}reset(){this.state="fadein",this.pos.y=this.canvas.height}}(Xt);let $t,qt,zt,Nt=[],Qt=1,Jt=null,Kt=!1,Zt=!1,te=!1;const ee=[];let ie=!1,se=[];const oe=[],he=[],ne=[],ae=[],re=new St(Ht,0,-120,75,"开始",40,_.selectLevel,{});oe.push(re);const le=b({x:0,y:400,color:"blue",text:"由LUMIN团队制作",font:"24px Arial",anchor:{x:.5,y:.5},textAlign:"center",context:Ht.getContext("2d")});oe.push(le);const ce=new St(Ht,0,120,75,"区块链",40,_.web3,{});function de(){he.length=0,Ft(Ht).forEach((t=>{he.push(t)}))}oe.push(ce);let pe=y(0,0),ue=y(0,0);r(_.drag,(({detail:t})=>{pe=ue.add(y(-t.diffX,0))})),r(_.burstBalloon,(t=>{t.particles.forEach((t=>{ee.push(t)}))})),r(_.down,(()=>{ue=y(pe)})),r(_.play,(({levelId:t,levelData:e})=>{setTimeout((()=>{Qt=t,Jt=e,Ot="l",Vt.reset(),ye.start()}),500)})),r(_.web3,(()=>{Gt();const t=b({x:0,y:-250,color:lt(1e3),text:"区块链已启用\n正在获取NPC和奖励关卡",font:"32px Arial",anchor:{x:.5,y:.5},textAlign:"center",context:Ht.getContext("2d")});oe.push(t)})),r(_.selectLevel,(({type:t})=>{setTimeout((()=>{Ot="b"===t?"b":"s",Vt.reset(),ye.start()}),500)})),r(_.bubbleParticle,(({pos:t})=>{ae.push(function(t,e){const i=new dt(t,e,{gasAmount:500,length:1,distance:2,numParticles:5,stiffness:.1,lineWidth:4,hideParticles:!0,hideText:!0,isStationairy:!0,balloonType:"d",timeToLive:1e3+2e3*Math.random()});return i.externalForce.x=(Math.random()-.3)/8,i.externalForce.y-=.17,i}(Ht,t))}));const xe=P({update:function(){for(let t=ae.length-1;t>=0;t--){const e=ae[t];e.update(),e.timeToLive<=0&&ae.splice(t,1)}"m"===Wt?(null==zt||zt.follow(y(0,0)),oe.forEach((t=>t.update()))):"s"===Wt?(null==zt||zt.follow(pe),he.forEach((t=>t.update()))):"b"===Wt?(null==zt||zt.follow(pe),ne.forEach((t=>t.update()))):(Nt.forEach((t=>t.update())),ee.forEach((t=>t.update())),null==zt||zt.follow(null==$t?void 0:$t.centerPoint.add(y(200,-100))),function(t){Dt+=1e3/60;let e=null;for(let i=0;i<t.length;i++){let s=null;const o=t[i];o.particles&&o.particles.forEach((h=>{let n=0;for(let l=0;l<t.length;l++)if(i!==l){const i=t[l];if(!i.springs)continue;i.springs.forEach((t=>{((null==o?void 0:o.isBalloon)||(null==o?void 0:o.isSpike))&&et(h.pos,t.p1.pos,t.p2.pos)&&n++;const a=it(h.pos,t.p1.pos,t.p2.pos);(!e||a.distance(h.pos)<e.distance(h.pos))&&(s=i,e=a)}))}var a,r;n%2==1&&e&&((a=o)!==(r=s)&&(null==a?void 0:a.isBalloon)&&(null==r?void 0:r.isBalloon)&&"d"!==(null==a?void 0:a.state)&&"d"!==(null==r?void 0:r.state)&&("e"===(null==a?void 0:a.balloonType)||"e"===(null==r?void 0:r.balloonType))&&(null==o||o.setState("d"),null==s||s.setState("d")),Bt(o,s)&&(null==o||o.setState("d")),Dt>jt&&(jt=50+200*Math.random(),Dt=0,c(_.bubbleParticle,{pos:e})),h.pos=y(e),h.velocity=h.velocity.scale(-1))}))}}([...Nt,...ee]),function(){if(Zt||te)return;"d"===$t.state&&(te=!0,Nt.push(b({x:$t.centerPoint.x,y:$t.centerPoint.y,font:"32px Arial",text:"气泡爆裂！",context:Ht.getContext("2d")})),setTimeout((()=>{Nt.length=0,te=!1,xe.stop(),me("l")}),2e3));qt.checkIfGoalReached($t)&&!Zt&&(S(...[.9,,579,.32,.03,.05,1,.8,,24,,,,,,,,.84,.04,,-1282]),Zt=!0,ee.length=0,setTimeout((()=>{Nt.length=0,Zt=!1,Jt?(Ct(`complete-bonus-${Qt}`,"true"),Jt=se.find((t=>t.levelId===Qt+1)),Qt++,Jt||(Qt=kt.length)):(Ct(`complete-${Qt}`,"true"),Qt++,13===Qt&&Qt++),xe.stop(),Vt.reset(),ye.start()}),20))}())},render:function(){const t=Ht.getContext("2d");zt.clear(t),zt.apply(t),ae.forEach((e=>e.render(t))),"m"===Wt?oe.forEach((e=>e.render(t))):"s"===Wt?he.forEach((e=>e.render(t))):"b"===Wt?ne.forEach((e=>e.render(t))):(!function(t){const e=Ut.getContext("2d");fe(Ut,e,t),fe(Ut,e,t,{type:"h"})}(zt),Nt.forEach((e=>e.render(t))),ee.forEach((e=>e.render(t))))}});const ye=P({update:function(){null==Vt||Vt.update(),!ie&&Vt.isFadeInComplete()?(ie=!0,"s"===Ot?(Wt="s",oe.forEach((t=>{t&&t.destroy&&t.destroy()})),oe.length=0):"b"===Ot?(Wt="b",oe.forEach((t=>{t&&t.destroy&&t.destroy()})),oe.length=0):"l"===Ot&&(me("l"),he.forEach((t=>{(null==t?void 0:t.destroy)&&t.destroy()})),ne.forEach((t=>{(null==t?void 0:t.destroy)&&t.destroy()})))):Vt.isFadeOutComplete()&&(ie=!1,null==Vt||Vt.reset(),ye.stop())},render:function(){const t=Xt.getContext("2d");null==Vt||Vt.render(t)}});let ge=2e3;function fe(t,e,i,s){const o=600;e.save();const{width:h,height:n}=t,a=e.createLinearGradient(0,n-200,0,n);e.setTransform(1,0,0,1,0,0),"h"===(null==s?void 0:s.type)?(a.addColorStop(0,"#010113"),a.addColorStop(1,"#060e1a"),e.translate(i.pos.x/-3,i.pos.y/-4)):(a.addColorStop(0,"#212133aa"),a.addColorStop(1,"#060e1a88"),e.translate(i.pos.x/-7,i.pos.y/-5)),e.fillStyle=a,e.beginPath(),e.moveTo(-ge,o),e.fillRect(-ge,580,h+2*ge,n);for(let r=-ge;r<=h+ge;r+=50){let t=0;t="h"===(null==s?void 0:s.type)?20*Math.sin(.02*r)+150:20*Math.sin(.01*r)+260,e.lineTo(r,o-t)}e.lineTo(h+ge,o),e.closePath(),e.fill(),e.restore()}async function me(t="m"){var e;Wt=t,Kt||(e=[de],Lt=[Ut,Xt,Ht],window.addEventListener("resize",(function(){At&&clearTimeout(At),At=window.setTimeout((()=>{It(),null==e||e.forEach((t=>t()))}),150)})),It(),null==e||e.forEach((t=>t())),Y=Ht,Y.addEventListener("mousedown",O),Y.addEventListener("mouseup",V),Y.addEventListener("mousemove",$),Y.addEventListener("touchstart",q,{passive:!1}),Y.addEventListener("touchend",z),Y.addEventListener("touchmove",N),zt=new J(Ht));const{player:i,goal:s,gameObjects:o}=Rt(Ht,zt,Qt,Jt);$t=i,qt=s,Nt=o,Nt.splice(0,0,$t),Nt.splice(0,0,s),Kt=!0,xe.start()}me("m");
